<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Itinerary | Voyager</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;700&family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        #map {
            position: relative;
            z-index: 0;
        }

        :root {
            --primary: #a0604d;
            --primary-dark: #824a38;
            --secondary: #e8d5c0;
            --accent: #c4a78a;
            --text: #333333;
            --text-light: #5a5a5a;
            --white: #ffffff;
            --shadow: 0 15px 30px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            background: #f9f7f4;
            color: var(--text);
            line-height: 1.6;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 5%;
            background: var(--white);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .navbar h1 {
            margin: 0;
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
            letter-spacing: 1px;
        }

        .container {
            padding: 60px 5%;
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 50px;
        }

        .header h2 {
            font-family: 'Playfair Display', serif;
            font-size: 36px;
            color: var(--primary);
            margin-bottom: 15px;
            letter-spacing: 0.5px;
        }

        .header p {
            color: var(--text-light);
            max-width: 700px;
            margin: 0 auto;
            font-size: 18px;
        }

        .itinerary-card {
            background: var(--white);
            padding: 40px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: none;
        }

        .itinerary-card.active {
            display: block;
        }

        .itinerary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .itinerary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: var(--primary);
        }

        .itinerary-card h2 {
            font-family: 'Playfair Display', serif;
            color: var(--primary);
            margin-top: 0;
            font-size: 28px;
            margin-bottom: 25px;
            position: relative;
            display: inline-block;
        }

        .itinerary-card h2::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 50px;
            height: 2px;
            background: var(--accent);
        }

        .timeline {
            display: grid;
            grid-template-columns: 120px 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .time {
            font-weight: 500;
            color: var(--primary);
            font-size: 18px;
            align-self: center;
        }

        .activity {
            background: var(--secondary);
            padding: 20px;
            border-radius: 8px;
            position: relative;
        }

        .activity::before {
            content: '';
            position: absolute;
            left: -10px;
            top: 20px;
            width: 0;
            height: 0;
            border-top: 10px solid transparent;
            border-bottom: 10px solid transparent;
            border-right: 10px solid var(--secondary);
        }

        .weather-info {
            background: rgba(197, 227, 246, 0.3);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            display: flex;
            align-items: center;
            border-left: 4px solid var(--primary);
        }

        .weather-icon {
            font-size: 32px;
            margin-right: 20px;
            color: var(--primary);
        }

        .weather-details {
            flex: 1;
        }

        .weather-details h4 {
            margin: 0 0 5px 0;
            color: var(--primary);
            font-size: 18px;
        }

        .weather-details p {
            margin: 0;
            color: var(--text-light);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            padding: 12px 24px;
            background: var(--primary);
            color: var(--white);
            border: none;
            border-radius: 6px;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(26, 106, 159, 0.3);
        }

        .btn i {
            margin-right: 8px;
        }

        .footer {
            text-align: center;
            padding: 30px;
            background: var(--primary);
            color: var(--white);
            margin-top: 60px;
        }

        .footer p {
            margin: 0;
            font-size: 14px;
        }

        .info-section {
            background: var(--white);
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .info-section h3 {
            color: var(--primary);
            margin-top: 0;
            font-family: 'Playfair Display', serif;
            border-bottom: 1px solid var(--accent);
            padding-bottom: 10px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .info-item {
            margin-bottom: 15px;
        }

        .info-item strong {
            color: var(--primary);
            display: block;
            margin-bottom: 5px;
        }

        /* Tab styles */
        .tab-container {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 20px;
            margin: 0 5px;
            background: var(--white);
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
            border: 1px solid var(--secondary);
        }

        .tab:hover {
            background: var(--secondary);
        }

        .tab.active {
            background: var(--primary);
            color: var(--white);
        }

        #map {
            height: 400px;
            width: 100%;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .weather-widget {
            background: var(--white);
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .weather-widget h3 {
            color: var(--primary);
            margin-top: 0;
            font-family: 'Playfair Display', serif;
            border-bottom: 1px solid var(--accent);
            padding-bottom: 10px;
        }

        .weather-cities {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .weather-city {
            text-align: center;
            padding: 15px;
            background: rgba(197, 227, 246, 0.3);
            border-radius: 8px;
        }

        .weather-city i {
            font-size: 36px;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .weather-city h4 {
            margin: 0 0 5px 0;
            color: var(--primary);
        }

        .weather-city p {
            margin: 0;
            color: var(--text-light);
            font-size: 14px;
        }

        .local-tips {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .tip-card {
            background: var(--white);
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }

        .tip-card h4 {
            color: var(--primary);
            margin-top: 0;
            display: flex;
            align-items: center;
        }

        .tip-card h4 i {
            margin-right: 10px;
        }

        .phrase-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .phrase-table th, .phrase-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid var(--secondary);
        }

        .phrase-table th {
            color: var(--primary);
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .container {
                padding: 40px 20px;
            }
            
            .timeline {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .activity::before {
                display: none;
            }
            
            .header h2 {
                font-size: 28px;
            }

            .tab {
                padding: 8px 12px;
                margin: 5px;
                font-size: 14px;
            }

            #map {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <h1><i class="fas fa-compass compass-icon"></i>Voyager</h1>
        <div>
            <button id="dark-mode-toggle" class="btn-icon" title="Toggle Dark Mode">
                <i class="fas fa-moon"></i>
            </button>
            <a href="/welcome" class="btn">
                <i class="fas fa-chevron-left"></i> Back to Welcome
            </a>
        </div>
    </nav>
        <style>
            /* Dark Mode Styles */
body.dark-mode {
    background: #121212;
    color: #e0e0e0;
}

body.dark-mode .navbar,
body.dark-mode .itinerary-card,
body.dark-mode .info-section,
body.dark-mode .weather-widget,
body.dark-mode .tip-card,
body.dark-mode .tab {
    background: #1e1e1e;
    color: #e0e0e0;
}

body.dark-mode .header h2,
body.dark-mode .itinerary-card h2,
body.dark-mode .info-section h3,
body.dark-mode .weather-widget h3,
body.dark-mode .tip-card h4,
body.dark-mode .time,
body.dark-mode .weather-details h4,
body.dark-mode .phrase-table th {
    color: var(--accent);
}

body.dark-mode .header p,
body.dark-mode .info-item span,
body.dark-mode .weather-details p,
body.dark-mode .phrase-table td,
body.dark-mode .activity p {
    color: #b0b0b0;
}

body.dark-mode .activity {
    background: #2a2a2a;
}

body.dark-mode .activity::before {
    border-right-color: #2a2a2a;
}

body.dark-mode .weather-info {
    background: rgba(40, 40, 40, 0.5);
}

body.dark-mode .weather-city {
    background: rgba(40, 40, 40, 0.5);
}

body.dark-mode .tab {
    border-color: #333;
}

body.dark-mode .tab:hover {
    background: #333;
}

body.dark-mode .tab.active {
    background: var(--primary-dark);
}
/* Icon button styles */
.btn-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    padding: 0;
    margin-right: 10px;
    background: var(--primary);
    color: var(--white);
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 16px;
}

.btn-icon:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(26, 106, 159, 0.3);
}

/* Adjust navbar layout */
.navbar > div {
    display: flex;
    align-items: center;
    gap: 10px;
}

/* Add this to your existing styles */
.btn-icon {
    height: 50px;
    width: 45px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    margin-right: 10px;
    background: var(--primary);
    color: var(--white);
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-icon:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(26, 106, 159, 0.3);
}

/* Adjust navbar layout to properly space buttons */
.navbar > div {
    display: flex;
    align-items: center;
    gap: 10px;
}
</style>
<script>
    // Add this at the beginning of your script section
// Dark Mode Toggle
// Dark Mode Toggle
document.getElementById('dark-mode-toggle').addEventListener('click', function() {
    document.body.classList.toggle('dark-mode');
    const icon = this.querySelector('i');
    if (document.body.classList.contains('dark-mode')) {
        icon.classList.remove('fa-moon');
        icon.classList.add('fa-sun');
        this.title = "Toggle Light Mode";
        localStorage.setItem('darkMode', 'enabled');
    } else {
        icon.classList.remove('fa-sun');
        icon.classList.add('fa-moon');
        this.title = "Toggle Dark Mode";
        localStorage.setItem('darkMode', 'disabled');
    }
});

// Check for saved dark mode preference
if (localStorage.getItem('darkMode') === 'enabled') {
    document.body.classList.add('dark-mode');
    const toggle = document.getElementById('dark-mode-toggle');
    toggle.querySelector('i').classList.remove('fa-moon');
    toggle.querySelector('i').classList.add('fa-sun');
    toggle.title = "Toggle Light Mode";
}

// Update the setupLocalTips function to properly get the destination
function setupLocalTips() {
    try {
        // Get destination directly from template variable
        let destination = "{{ itinerary.destination }}".trim().toLowerCase();
        
        // If empty, try to extract from the first day's title
        if (!destination || destination === 'undefined') {
            const firstDayTitle = document.querySelector('.itinerary-card h2');
            if (firstDayTitle) {
                const titleText = firstDayTitle.textContent;
                // Try to extract location from "Day 1: Paris - Exploring the City"
                const match = titleText.match(/Day \d+: (.+?) -/);
                destination = match ? match[1].trim().toLowerCase() : titleText.replace(/^Day \d+: /, '').trim().toLowerCase();
            }
        }

        // Default values
        let phrases = {
            hello: { phrase: "Hello", pronunciation: "heh-loh" },
            thanks: { phrase: "Thank you", pronunciation: "thank yoo" },
            price: { phrase: "How much?", pronunciation: "how much" }
        };
        
        let currencyInfo = "Local currency information not specified";
        let quickFacts = "Interesting facts about your destination will appear here";
        
        // Enhanced location data matching
        const locationData = {
            'paris|france': {
                phrases: {
                    hello: { phrase: "Bonjour", pronunciation: "bohn-zhoor" },
                    thanks: { phrase: "Merci", pronunciation: "mehr-see" },
                    price: { phrase: "Combien?", pronunciation: "kohm-byen" }
                },
                currency: "Euro (€) - 1 EUR ≈ 1.07 USD",
                quickFacts: "France is the most visited country in the world. The French consume around 25,000 tons of snails each year. Paris has only one stop sign in the entire city."
            },
            'barcelona|madrid|spain': {
                phrases: {
                    hello: { phrase: "Hola", pronunciation: "oh-la" },
                    thanks: { phrase: "Gracias", pronunciation: "grah-see-ahs" },
                    price: { phrase: "¿Cuánto cuesta?", pronunciation: "kwahn-toh kwehs-tah" }
                },
                currency: "Euro (€) - 1 EUR ≈ 1.07 USD",
                quickFacts: "Spain has the third highest number of UNESCO World Heritage Sites. The Spanish national anthem has no words. Spain has over 8,000 km of beaches."
            },
            'tokyo|kyoto|japan': {
                phrases: {
                    hello: { phrase: "こんにちは", pronunciation: "kon-ni-chi-wa" },
                    thanks: { phrase: "ありがとう", pronunciation: "a-ri-ga-toh" },
                    price: { phrase: "いくらですか？", pronunciation: "ee-koo-rah des-ka" }
                },
                currency: "Yen (¥) - 1 JPY ≈ 0.007 USD",
                quickFacts: "Japan has more than 5 million vending machines. The world's oldest company (578 AD) is in Japan. Many Japanese trains are among the most punctual in the world, with average delays of just 18 seconds."
            }
            // ... (keep the rest of your location data)
        };

        // Find matching location - now checks each key more thoroughly
        for (const [pattern, data] of Object.entries(locationData)) {
            const patterns = pattern.split('|');
            for (const p of patterns) {
                if (destination.includes(p)) {
                    phrases = data.phrases;
                    currencyInfo = data.currency;
                    quickFacts = data.quickFacts;
                    break;
                }
            }
        }
        
        // Update the DOM
        document.getElementById('hello-phrase').textContent = phrases.hello.phrase;
        document.getElementById('hello-pronunciation').textContent = phrases.hello.pronunciation;
        document.getElementById('thanks-phrase').textContent = phrases.thanks.phrase;
        document.getElementById('thanks-pronunciation').textContent = phrases.thanks.pronunciation;
        document.getElementById('price-phrase').textContent = phrases.price.phrase;
        document.getElementById('price-pronunciation').textContent = phrases.price.pronunciation;
        document.getElementById('currency-info').textContent = currencyInfo;
        document.getElementById('quick-facts').textContent = quickFacts;
    } catch (e) {
        console.error("Local tips error:", e);
    }
}

</script>
    <div class="container">
        <div class="header">
            <h2>Your Voyager Itinerary</h2>
            <p>Expertly crafted journey designed for the modern explorer. All activities are optimized for weather conditions and local insights.</p>
        </div>

        <!-- Interactive Map -->
        <div id="map"></div>

        <!-- Weather Widget -->
        <div class="weather-widget">
            <h3>Current Weather</h3>
            <div class="weather-cities" id="weather-cities">
                <!-- Weather data will be populated here -->
            </div>
        </div>

        <!-- Local Tips Section -->
        <div class="info-section">
            <h3>Local Tips</h3>
            <div class="local-tips">
                <div class="tip-card">
                    <h4><i class="fas fa-money-bill-wave"></i> Currency</h4>
                    <p id="currency-info">Loading currency information...</p>
                </div>
                <div class="tip-card">
                    <h4><i class="fas fa-language"></i> Useful Phrases</h4>
                    <table class="phrase-table">
                        <tr>
                            <th>English</th>
                            <th>Local Language</th>
                            <th>Pronunciation</th>
                        </tr>
                        <tr>
                            <td>Hello</td>
                            <td id="hello-phrase">-</td>
                            <td id="hello-pronunciation">-</td>
                        </tr>
                        <tr>
                            <td>Thank you</td>
                            <td id="thanks-phrase">-</td>
                            <td id="thanks-pronunciation">-</td>
                        </tr>
                        <tr>
                            <td>How much?</td>
                            <td id="price-phrase">-</td>
                            <td id="price-pronunciation">-</td>
                        </tr>
                    </table>
                </div>
                <div class="tip-card">
                    <h4><i class="fas fa-info-circle"></i> Quick Facts</h4>
                    <p id="quick-facts">Loading destination facts...</p>
                </div>
            </div>
        </div>

        <!-- Day Tabs -->
        <div class="tab-container" id="day-tabs">
            <!-- Tabs will be generated dynamically -->
        </div>

        {% for day in itinerary.days %}
        <div class="itinerary-card {% if loop.first %}active{% endif %}" id="day{{ day.day }}">
            <h2>Day {{ day.day }}: {{ day.title }}</h2>

            {% for activity in day.activities %}
            <div class="timeline">
                <span class="time">{{ activity.time }}</span>
                <div class="activity">
                    <strong>{{ activity.activity }}</strong>
                    <p>{{ activity.description }}</p>
                    <div class="activity-meta">
                        <span class="meta-item">
                            <i class="fas fa-money-bill-wave"></i> 
                            {{ activity.cost_estimate or 'Cost not specified' }}
                        </span>
                        <span class="meta-item">
                            <i class="fas fa-bus"></i> 
                            {{ activity.transportation or 'Transport not specified' }}
                        </span>
                    </div>
                </div>
            </div>
            {% endfor %}

            <div class="weather-info">
                <i class="{{ day.weather.icon }} weather-icon"></i>
                <div class="weather-details">
                    <h4>Weather Advisory</h4>
                    <p>{{ day.weather.forecast }}</p>
                </div>
            </div>
        </div>
        {% endfor %}

        <div class="info-section">
            <h3>What's Included</h3>
            <div class="info-grid">
                <div>
                    <div class="info-item">
                        <strong>✔ Transportation</strong>
                        <span>All transfers and transportation mentioned in the itinerary</span>
                    </div>
                    <div class="info-item">
                        <strong>✔ Activities</strong>
                        <span>All scheduled activities and experiences</span>
                    </div>
                </div>
                <div>
                    <div class="info-item">
                        <strong>✔ Accommodation</strong>
                        <span>Recommended stays based on your preferences</span>
                    </div>
                    <div class="info-item">
                        <strong>✔ Support</strong>
                        <span>24/7 travel assistance during your trip</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="info-section">
            <h3>Packing Essentials</h3>
            <ul style="columns: 2; column-gap: 40px; padding-left: 20px;">
                <li>Weather-appropriate clothing</li>
                <li>Comfortable walking shoes</li>
                <li>Travel adapter</li>
                <li>Essential medications</li>
                <li>Camera/phone for photos</li>
                <li>Travel documents</li>
                <li>Reusable water bottle</li>
                <li>Daypack for excursions</li>
            </ul>
        </div>

        <div class="customize-message">
            <h3>Want to customize this itinerary?</h3>
            <p>Log in or register to make modifications, add activities, or adjust the schedule to perfectly match your travel preferences.</p>
            <a href="login" class="btn">
                <i class="fas fa-user-circle"></i> Login/Register
            </a>
        </div>
    </div>

    <footer class="footer">
        <p>© 2025 Voyager | Navigating Extraordinary Experiences</p>
    </footer>
    <script>
        // Global variables
        let map;
    let destination = "{{ itinerary.destination if itinerary and itinerary.destination else '' }}".trim();
    let daysCount = document.querySelectorAll('.itinerary-card').length;

        // Main initialization function
        

        // Show specific day content
        function showDay(dayNumber) {
            try {
                // Hide all itinerary cards
                document.querySelectorAll('.itinerary-card').forEach(card => {
                    card.classList.remove('active');
                });
                
                // Show selected day
                const dayCard = document.getElementById(`day${dayNumber}`);
                if (dayCard) {
                    dayCard.classList.add('active');
                }
                
                // Update tab states
                document.querySelectorAll('.tab').forEach((tab, index) => {
                    tab.classList.toggle('active', index === dayNumber - 1);
                });
            } catch (e) {
                console.error("Error showing day:", e);
            }
        }

       
// Update the map initialization
function initMap(destination) {
    try {
        map = L.map('map').setView([20, 0], 2);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        if (destination) {
            const coords = getApproximateCoordinates(destination);
            if (coords) {
                map.setView(coords, 10);
                L.marker(coords).addTo(map)
                    .bindPopup(`<b>${destination}</b><br>Your travel destination`)
                    .openPopup();
            }
        }
    } catch (e) {
        console.error("Map initialization error:", e);
    }
}


        // Setup day tabs navigation
        function setupDayTabs() {
            try {
                const dayTabsContainer = document.getElementById('day-tabs');
                
                if (!dayTabsContainer) {
                    console.warn("Day tabs container not found");
                    return;
                }
                
                dayTabsContainer.innerHTML = '';
                
                for (let i = 1; i <= daysCount; i++) {
                    const tab = document.createElement('div');
                    tab.className = 'tab' + (i === 1 ? ' active' : '');
                    tab.textContent = `Day ${i}`;
                    tab.onclick = () => showDay(i);
                    dayTabsContainer.appendChild(tab);
                }
            } catch (e) {
                console.error("Tab setup error:", e);
            }
        }


function getApproximateCoordinates(destination) {
    const lowerDest = destination.toLowerCase();
    const knownLocations = {
        "paris": [48.8566, 2.3522],
        "london": [51.5074, -0.1278],
        "new york": [40.7128, -74.0060],
        "tokyo": [35.6762, 139.6503],
        "rome": [41.9028, 12.4964],
        "barcelona": [41.3851, 2.1734],
        "berlin": [52.5200, 13.4050],
        "amsterdam": [52.3676, 4.9041],
        "dubai": [25.276987, 55.296249],
        "sydney": [-33.8688, 151.2093],
        "hong kong": [22.3193, 114.1694],
        "singapore": [1.3521, 103.8198],
        "bangkok": [13.7563, 100.5018],
        "los angeles": [34.0522, -118.2437],
        "san francisco": [37.7749, -122.4194]
    };
    
    for (const [key, coords] of Object.entries(knownLocations)) {
        if (lowerDest.includes(key)) {
            return coords;
        }
    }
    return [20, 0]; // Default coordinates if no match
}

function getWeatherDataForDestination(dest) {
    const lowerDest = dest.toLowerCase();
    const now = new Date();
    const month = now.getMonth() + 1;
    
    // Default weather data (fallback)
    let weatherData = [
        { name: "Main City", temp: "25°C / 77°F", condition: "Sunny", icon: "sun" },
        { name: "Coastal Area", temp: "23°C / 73°F", condition: "Partly Cloudy", icon: "cloud-sun" },
        { name: "Mountain Area", temp: "18°C / 64°F", condition: "Clear", icon: "mountain" }
    ];
    
    // Europe destinations
    if (lowerDest.includes("paris") || lowerDest.includes("london") || 
        lowerDest.includes("rome") || lowerDest.includes("berlin") || 
        lowerDest.includes("amsterdam") || lowerDest.includes("barcelona")) {
        if (month >= 11 || month <= 3) {
            // Winter
            weatherData = [
                { name: "City Center", temp: "5°C / 41°F", condition: "Cloudy", icon: "cloud" },
                { name: "Countryside", temp: "3°C / 37°F", condition: "Chilly", icon: "temperature-low" },
                { name: "Mountains", temp: "-2°C / 28°F", condition: "Snow", icon: "snowflake" }
            ];
        } else if (month >= 4 && month <= 6) {
            // Spring
            weatherData = [
                { name: "City Center", temp: "15°C / 59°F", condition: "Partly Cloudy", icon: "cloud-sun" },
                { name: "Countryside", temp: "13°C / 55°F", condition: "Sunny", icon: "sun" },
                { name: "Coastal", temp: "16°C / 61°F", condition: "Breezy", icon: "wind" }
            ];
        } else {
            // Summer/Fall
            weatherData = [
                { name: "City Center", temp: "22°C / 72°F", condition: "Sunny", icon: "sun" },
                { name: "Countryside", temp: "20°C / 68°F", condition: "Clear", icon: "sun" },
                { name: "Mountains", temp: "15°C / 59°F", condition: "Partly Cloudy", icon: "cloud-sun" }
            ];
        }
    }
            // Asian destinations
            else if (lowerDest.includes("tokyo") || lowerDest.includes("bangkok") || 
                     lowerDest.includes("hong kong") || lowerDest.includes("singapore")) {
                if (month >= 6 && month <= 9) {
                    // Rainy season
                    weatherData = [
                        { name: "City Center", temp: "28°C / 82°F", condition: "Rainy", icon: "cloud-rain" },
                        { name: "Countryside", temp: "26°C / 79°F", condition: "Humid", icon: "water" },
                        { name: "Mountains", temp: "22°C / 72°F", condition: "Misty", icon: "smog" }
                    ];
                } else {
                    // Dry season
                    weatherData = [
                        { name: "City Center", temp: "22°C / 72°F", condition: "Sunny", icon: "sun" },
                        { name: "Countryside", temp: "20°C / 68°F", condition: "Clear", icon: "sun" },
                        { name: "Coastal", temp: "24°C / 75°F", condition: "Breezy", icon: "wind" }
                    ];
                }
            }
            // Middle East destinations
            else if (lowerDest.includes("dubai")) {
                if (month >= 5 && month <= 9) {
                    // Hot season
                    weatherData = [
                        { name: "City Center", temp: "38°C / 100°F", condition: "Sunny", icon: "sun" },
                        { name: "Desert", temp: "42°C / 108°F", condition: "Hot", icon: "temperature-high" },
                        { name: "Coastal", temp: "35°C / 95°F", condition: "Humid", icon: "water" }
                    ];
                } else {
                    // Mild season
                    weatherData = [
                        { name: "City Center", temp: "25°C / 77°F", condition: "Sunny", icon: "sun" },
                        { name: "Desert", temp: "22°C / 72°F", condition: "Clear", icon: "sun" },
                        { name: "Mountains", temp: "18°C / 64°F", condition: "Cool", icon: "temperature-low" }
                    ];
                }
            }
            
            return weatherData;
        }

// Main initialization function
function initializePage() {
    try {
        // Get destination from template variable
        const destination = "{{ itinerary.destination }}".trim();
        
        // Initialize map with destination
        initMap(destination);
        
        // Setup tabs
        setupDayTabs();
        
        // Setup weather with destination
        setupWeatherWidget(destination);
        
        // Setup local tips with destination
        setupLocalTips(destination);
        
        // Show first day
        if (daysCount > 0) showDay(1);
    } catch (e) {
        console.error("Initialization error:", e);
    }
}

// Update the map initialization
function initMap(destination) {
    try {
        map = L.map('map').setView([20, 0], 2);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        if (destination) {
            const coords = getApproximateCoordinates(destination);
            if (coords) {
                map.setView(coords, 10);
                L.marker(coords).addTo(map)
                    .bindPopup(`<b>${destination}</b><br>Your travel destination`)
                    .openPopup();
            }
        }
    } catch (e) {
        console.error("Map initialization error:", e);
    }
}

// Setup weather widget with dynamic data
function setupWeatherWidget(destination) {
    try {
        const weatherCities = document.getElementById('weather-cities');
        if (!weatherCities) return;
        
        const weatherData = getWeatherDataForDestination(destination);
        weatherCities.innerHTML = weatherData.map(city => `
            <div class="weather-city">
                <i class="fas fa-${city.icon}"></i>
                <h4>${city.name}</h4>
                <p>${city.temp}°C</p>
                <p>${city.condition}</p>
            </div>
        `).join('');
    } catch (e) {
        console.error("Weather widget error:", e);
    }
}

// Setup all local tips (currency, phrases, quick facts)
function setupLocalTips(destination) {
    try {
        // Clean the destination (trim and lowercase)
        destination = (destination || "").trim().toLowerCase();
        
        // Default values
        let phrases = {
            hello: { phrase: "Hello", pronunciation: "heh-loh" },
            thanks: { phrase: "Thank you", pronunciation: "thank yoo" },
            price: { phrase: "How much?", pronunciation: "how much" }
        };
        
        let currencyInfo = "Local currency information not specified";
        let quickFacts = "Interesting facts about your destination will appear here";
        
        // Enhanced location data matching
        const locationData = {
            'paris|france': {
                phrases: {
                    hello: { phrase: "Bonjour", pronunciation: "bohn-zhoor" },
                    thanks: { phrase: "Merci", pronunciation: "mehr-see" },
                    price: { phrase: "Combien?", pronunciation: "kohm-byen" }
                },
                currency: "Euro (€) - 1 EUR ≈ 1.07 USD",
                quickFacts: "France is the most visited country in the world. The French consume around 25,000 tons of snails each year. Paris has only one stop sign in the entire city."
            },
            'barcelona|madrid|spain': {
                phrases: {
                    hello: { phrase: "Hola", pronunciation: "oh-la" },
                    thanks: { phrase: "Gracias", pronunciation: "grah-see-ahs" },
                    price: { phrase: "¿Cuánto cuesta?", pronunciation: "kwahn-toh kwehs-tah" }
                },
                currency: "Euro (€) - 1 EUR ≈ 1.07 USD",
                quickFacts: "Spain has the third highest number of UNESCO World Heritage Sites. The Spanish national anthem has no words. Spain has over 8,000 km of beaches."
            },
            'tokyo|kyoto|japan': {
                phrases: {
                    hello: { phrase: "こんにちは", pronunciation: "kon-ni-chi-wa" },
                    thanks: { phrase: "ありがとう", pronunciation: "a-ri-ga-toh" },
                    price: { phrase: "いくらですか？", pronunciation: "ee-koo-rah des-ka" }
                },
                currency: "Yen (¥) - 1 JPY ≈ 0.007 USD",
                quickFacts: "Japan has more than 5 million vending machines. The world's oldest company (578 AD) is in Japan. Many Japanese trains are among the most punctual in the world, with average delays of just 18 seconds."
            },
            'new york|usa|united states': {
                phrases: {
                    hello: { phrase: "Hello", pronunciation: "heh-loh" },
                    thanks: { phrase: "Thank you", pronunciation: "thank yoo" },
                    price: { phrase: "How much?", pronunciation: "how much" }
                },
                currency: "US Dollar ($) - 1 USD ≈ 0.93 EUR",
                quickFacts: "New York City has the largest subway system in the world. There's a secret train platform under the Waldorf Astoria hotel. More than 800 languages are spoken in NYC, making it the most linguistically diverse city in the world."
            },
            'london|uk|united kingdom': {
                phrases: {
                    hello: { phrase: "Hello", pronunciation: "heh-loh" },
                    thanks: { phrase: "Thank you", pronunciation: "thank yoo" },
                    price: { phrase: "How much?", pronunciation: "how much" }
                },
                currency: "British Pound (£) - 1 GBP ≈ 1.27 USD",
                quickFacts: "London has over 170 museums. The London Underground is the oldest underground railway network in the world. Big Ben is actually the name of the bell, not the clock tower."
            },
            'rome|italy': {
                phrases: {
                    hello: { phrase: "Ciao", pronunciation: "chow" },
                    thanks: { phrase: "Grazie", pronunciation: "grah-tsee-eh" },
                    price: { phrase: "Quanto costa?", pronunciation: "kwahn-toh koh-stah" }
                },
                currency: "Euro (€) - 1 EUR ≈ 1.07 USD",
                quickFacts: "Rome has more fountains than any other city in the world. The Colosseum could hold between 50,000 and 80,000 spectators. In Rome, it's illegal to sit on the Spanish Steps while eating."
            },
            'dubai|uae': {
                phrases: {
                    hello: { phrase: "Marhaba", pronunciation: "mar-ha-ba" },
                    thanks: { phrase: "Shukran", pronunciation: "shook-ran" },
                    price: { phrase: "Bikam?", pronunciation: "bee-kam" }
                },
                currency: "UAE Dirham (AED) - 1 AED ≈ 0.27 USD",
                quickFacts: "Dubai has the world's tallest building (Burj Khalifa). The police force has a fleet of supercars. The city has an indoor ski resort in the middle of the desert."
            },
            'bangkok|thailand': {
                phrases: {
                    hello: { phrase: "Sawasdee", pronunciation: "sa-was-dee" },
                    thanks: { phrase: "Khop khun", pronunciation: "kop koon" },
                    price: { phrase: "Tao rai?", pronunciation: "tao rye" }
                },
                currency: "Thai Baht (฿) - 1 THB ≈ 0.028 USD",
                quickFacts: "Bangkok's full name is the longest city name in the world. The city has over 400 temples. It's home to the world's largest golden Buddha statue."
            }
        };

        // Find matching location
        for (const [pattern, data] of Object.entries(locationData)) {
            const patterns = pattern.split('|');
            for (const p of patterns) {
                if (destination.includes(p)) {
                    phrases = data.phrases;
                    currencyInfo = data.currency;
                    quickFacts = data.quickFacts;
                    break;
                }
            }
        }
        
        // Update the DOM
        document.getElementById('hello-phrase').textContent = phrases.hello.phrase;
        document.getElementById('hello-pronunciation').textContent = phrases.hello.pronunciation;
        document.getElementById('thanks-phrase').textContent = phrases.thanks.phrase;
        document.getElementById('thanks-pronunciation').textContent = phrases.thanks.pronunciation;
        document.getElementById('price-phrase').textContent = phrases.price.phrase;
        document.getElementById('price-pronunciation').textContent = phrases.price.pronunciation;
        document.getElementById('currency-info').textContent = currencyInfo;
        document.getElementById('quick-facts').textContent = quickFacts;
    } catch (e) {
        console.error("Local tips error:", e);
    }
}
        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>