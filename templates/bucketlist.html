<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuestLog - Gamified Travel Bucket List</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --primary: #a0604d; /* Terracotta */
            --primary-light: #c97e6d;
            --primary-lighter: #e8b4a8;
            --primary-dark: #7a4a3a;
            --secondary: #FFFFFF;
            --text: #333333;
            --text-light: #666666;
            --text-lighter: #999999;
            --background: #f5f5dc;
            --card-bg: #FFFFFF;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 8px 24px rgba(0, 0, 0, 0.12);
            --success: #5cb85c;
            --warning: #f0ad4e;
            --danger: #d9534f;
            --info: #5bc0de;
            --pastel-blue: #a7c7e7;
            --pastel-green: #c1e1c1;
            --pastel-pink: #ffd1dc;
            --pastel-purple: #d8bfd8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background);
            color: var(--text);
            min-height: 100vh;
            background-image: url('https://images.unsplash.com/photo-1518655048521-f130df041f66?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-blend-mode: overlay;
            background-color: #f5f5dc
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Gamification Header */
        .game-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--secondary);
            padding: 2rem;
            border-radius: 16px;
            margin-bottom: 2rem;
            text-align: center;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(255,255,255,0.15);
            animation: fadeInDown 0.8s ease-out;
            display: flex;
            flex-direction: column;
            align-items: center;
            backdrop-filter: blur(4px);
            background-color: rgba(160, 96, 77, 0.9);
        }

        .xp-container {
            width: 100%;
            max-width: 500px;
            margin-top: 1rem;
        }

        .xp-bar {
            height: 10px;
            background-color: rgba(255,255,255,0.3);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .xp-progress {
            height: 100%;
            background: linear(90deg, var(--primary-light), var(--secondary));
            transition: width 0.5s ease;
        }

        .xp-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .level-badge {
            background-color: var(--primary-dark);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 0.5rem;
            display: inline-block;
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 2.5fr 1.5fr;
            gap: 2rem;
            min-height: calc(100vh - 200px);
        }

        /* Left Column - Map and Activities */
        .left-column {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        /* Right Column - Bucket List and Stats */
        .right-column {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        /* Map Container */
        .map-container {
            height: 500px;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow);
            position: relative;
            border: 3px solid var(--secondary);
            transition: transform 0.3s;
            background-color: rgba(255, 255, 255, 0.95);
        }

        #travelMap {
            height: 100%;
            width: 100%;
            border-radius: 14px;
        }

        /* Bucket List Styles */
        .bucket-list-container {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 1.8rem;
            border-radius: 16px;
            box-shadow: var(--shadow);
            border: 2px solid rgba(160, 96, 77, 0.15);
        }

        .bucket-list {
            margin-top: 1rem;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .bucket-item {
            display: flex;
            align-items: center;
            padding: 0.8rem 1rem;
            margin-bottom: 0.8rem;
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--shadow);
            transition: all 0.3s;
            cursor: pointer;
        }

        .bucket-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }

        .bucket-item.completed {
            background-color: var(--pastel-green);
            opacity: 0.8;
        }

        .bucket-checkbox {
            margin-right: 1rem;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .bucket-text {
            flex: 1;
            font-size: 0.95rem;
        }

        .bucket-location {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 0.2rem;
        }

        .add-bucket-item {
            display: flex;
            margin-top: 1rem;
        }

        .add-bucket-input {
            flex: 1;
            padding: 0.8rem;
            border: 1px solid var(--primary-lighter);
            border-radius: 8px 0 0 8px;
            font-family: 'Poppins', sans-serif;
        }

        .add-bucket-btn {
            padding: 0 1.2rem;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 0 8px 8px 0;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .add-bucket-btn:hover {
            background-color: var(--primary-dark);
        }

        /* Achievements Section */
        .achievements-section {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 1.8rem;
            border-radius: 16px;
            box-shadow: var(--shadow);
            border: 2px solid rgba(160, 96, 77, 0.15);
            animation: fadeInUp 0.8s ease-out 0.4s both;
        }

        .achievements-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            text-align: left;
        }

        .achievement {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: all 0.3s;
            border-left: 4px solid var(--primary);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.8rem;
            height: 100%;
        }

        .achievement-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            width: 100%;
        }

        .achievement-icon {
            font-size: 1.8rem;
            color: var(--primary);
            min-width: 40px;
        }

        .achievement-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-dark);
            margin: 0;
        }

        .achievement-desc {
            font-size: 0.9rem;
            color: var(--text-light);
            line-height: 1.5;
        }

        .achievement-progress {
            width: 100%;
            height: 8px;
            background-color: rgba(0,0,0,0.1);
            border-radius: 4px;
            margin-top: 0.8rem;
            overflow: hidden;
        }

        .achievement-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            width: 0%;
            transition: width 0.5s ease;
        }

        .progress-milestones {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 0.8rem;
        }

        .milestone {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.7rem;
            color: var(--text-light);
        }

        .milestone-badge {
            width: 20px;
            height: 20px;
            background-color: var(--primary-lighter);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.2rem;
            font-size: 0.6rem;
            font-weight: bold;
        }

        /* Travel Bingo Section */
        .bingo-section {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 1.8rem;
            border-radius: 16px;
            box-shadow: var(--shadow);
            border: 2px solid rgba(160, 96, 77, 0.15);
            margin-top: 2rem;
        }

        .bingo-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.25rem;
            margin: 1.5rem auto 0 auto;
            width: fit-content;
        }

        .bingo-cell {
            width: 100%;
            aspect-ratio: 1/1;
            background-color: var(--card-bg);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 0.3rem;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: var(--shadow);
            border: 2px solid transparent;
        }

        .bingo-cell.completed {
            background-color: var(--pastel-green);
            border-color: var(--primary);
        }

        .bingo-cell:hover {
            transform: scale(1.05);
        }

        /* Personality Quiz Section */
        .quiz-section {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 1.8rem;
            border-radius: 16px;
            box-shadow: var(--shadow);
            border: 2px solid rgba(160, 96, 77, 0.15);
            margin-top: 2rem;
        }

        .quiz-container {
            margin-top: 1.5rem;
        }

        .quiz-question {
            display: none;
            margin-bottom: 1.5rem;
        }

        .quiz-question.active {
            display: block;
        }

        .quiz-question-text {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 1rem;
            color: var(--primary-dark);
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .quiz-option {
            padding: 0.8rem;
            background-color: var(--card-bg);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid var(--primary-lighter);
        }

        .quiz-option:hover {
            background-color: var(--primary-lighter);
        }

        .quiz-option.selected {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary-dark);
        }

        .quiz-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
        }

        .quiz-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            transition: background-color 0.3s;
        }

        .quiz-btn:hover {
            background-color: var(--primary-dark);
        }

        .quiz-btn:disabled {
            background-color: var(--text-lighter);
            cursor: not-allowed;
        }

        .quiz-result {
            display: none;
            margin-top: 1.5rem;
            padding: 1.5rem;
            background-color: var(--primary-lighter);
            border-radius: 12px;
            text-align: center;
        }

        .quiz-result.active {
            display: block;
        }

        .quiz-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 1rem;
            border: 4px solid var(--primary);
        }

        .quiz-title {
            font-size: 1.3rem;
            color: var(--primary-dark);
            margin-bottom: 0.5rem;
        }

        .quiz-desc {
            font-size: 0.9rem;
            color: var(--text);
        }

        /* Photo Challenges Section */
        .photo-challenges-section {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 1.8rem;
            border-radius: 16px;
            box-shadow: var(--shadow);
            border: 2px solid rgba(160, 96, 77, 0.15);
            margin-top: 2rem;
        }

        .photo-challenges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .photo-challenge {
            background-color: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s;
            cursor: pointer;
        }

        .photo-challenge:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .photo-challenge-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }

        .photo-challenge-info {
            padding: 1rem;
        }

        .photo-challenge-title {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
            color: var(--primary-dark);
        }

        .photo-challenge-desc {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .photo-challenge-status {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            background-color: var(--pastel-green);
            border-radius: 4px;
            font-size: 0.7rem;
            margin-top: 0.5rem;
            color: var(--primary-dark);
        }

        /* Postcard Generator Section */
        .postcard-section {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 1.8rem;
            border-radius: 18px;
            box-shadow: var(--shadow);
            border: 2px solid rgba(160, 96, 77, 0.15);
            margin-top: 2rem;
        }

        .postcard-preview {
            width: 100%;
            max-width: 600px;
            margin: 1rem auto;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .postcard-image {
            width: 100%;
            display: block;
            border-bottom: 1px solid #eee ;
            object-fit: cover;
        }

        .postcard-message {
            padding: 1rem;
            font-size: 1rem;
            color: #333;
            line-height: 1.5;
            white-space: pre-line; /* Keeps line breaks */
            background-color: #fffbe6; /* light beige for postcard feel */
        }

      
        .postcard-controls {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .postcard-control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .postcard-control-group label {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .postcard-control-group input,
        .postcard-control-group textarea,
        .postcard-control-group select {
            padding: 0.5rem;
            border: 1px solid var(--primary-lighter);
            border-radius: 4px;
            font-family: 'Poppins', sans-serif;
        }

        .postcard-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            transition: background-color 0.3s;
            margin-top: 1rem;
            width: 100%;
        }

        .postcard-btn:hover {
            background-color: var(--primary-dark);
        }

        /* Avatar Customization Section */
        .avatar-section {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 1.8rem;
            border-radius: 16px;
            box-shadow: var(--shadow);
            border: 2px solid rgba(160, 96, 77, 0.15);
            margin-top: 2rem;
        }

        .avatar-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 1.5rem;
        }

        .avatar-preview {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background-color: var(--pastel-blue);
            margin-bottom: 1.5rem;
            border: 4px solid var(--primary);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .avatar-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            width: 100%;
        }

        .avatar-option {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--card-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: var(--shadow);
        }

        .avatar-option:hover {
            transform: scale(1.1);
        }

        .avatar-option.selected {
            box-shadow: 0 0 0 3px var(--primary);
        }

        .avatar-accessories {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            width: 100%;
            margin-top: 1rem;
        }

        .accessory-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--card-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: var(--shadow);
        }

        .accessory-option:hover {
            transform: scale(1.1);
        }

        .accessory-option.selected {
            box-shadow: 0 0 0 3px var(--primary);
        }

        .save-avatar-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 1.5rem;
            font-family: 'Poppins', sans-serif;
            transition: background-color 0.3s;
        }

        .save-avatar-btn:hover {
            background-color: var(--primary-dark);
        }

        /* Travel Badges Section */
        .badges-section {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 1.8rem;
            border-radius: 16px;
            box-shadow: var(--shadow);
            border: 2px solid rgba(160, 96, 77, 0.15);
            margin-top: 2rem;
        }

        .badges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .badge {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .badge:hover {
            transform: scale(1.1);
        }

        .badge-icon {
            width: 60px;
            height: 60px;
            background-color: var(--pastel-pink);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--primary-dark);
            border: 2px solid var(--primary-light);
        }

        .badge.unlocked .badge-icon {
            background-color: var(--primary-lighter);
            box-shadow: 0 0 0 3px var(--primary);
        }

        .badge-name {
            font-size: 0.7rem;
            color: var(--text-light);
        }

        /* Journey Timeline */
        .timeline-section {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 1.8rem;
            border-radius: 16px;
            box-shadow: var(--shadow);
            border: 2px solid rgba(160, 96, 77, 0.15);
            margin-top: 2rem;
        }

        /* Timeline */
        .timeline {
            position: relative;
            margin-top: 2rem;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: var(--primary-lighter);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px dashed var(--primary-lighter);
        }

        .timeline-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .timeline-dot {
            position: absolute;
            left: -30px;
            top: 5px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: var(--primary);
            border: 3px solid var(--secondary);
        }

        .timeline-date {
            font-size: 0.8rem;
            color: var(--primary);
            font-weight: 500;
            margin-bottom: 0.3rem;
        }

        .timeline-content {
            font-size: 0.9rem;
            color: var(--text);
        }

        .timeline-location {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 0.3rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        /* Stats Section */
        .stats-section {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 1.8rem;
            border-radius: 16px;
            box-shadow: var(--shadow);
            border: 2px solid rgba(160, 96, 77, 0.15);
        }

        .stat-card {
            background-color: var(--primary-lighter);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-dark);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        /* Adventure Game Section */
        .adventure-game-section {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 1.8rem;
            border-radius: 16px;
            box-shadow: var(--shadow);
            border: 2px solid rgba(160, 96, 77, 0.15);
            margin-top: 2rem;
        }

        .adventure-scene {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .adventure-text {
            font-size: 1rem;
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }

        .adventure-options {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .adventure-option {
            padding: 0.8rem;
            background-color: var(--card-bg);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid var(--primary-lighter);
        }

        .adventure-option:hover {
            background-color: var(--primary-lighter);
        }

        .adventure-result {
            display: none;
            margin-top: 1.5rem;
            padding: 1.5rem;
            background-color: var(--primary-lighter);
            border-radius: 12px;
            text-align: center;
        }

        .adventure-result.active {
            display: block;
        }

        .restart-adventure-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 1rem;
            font-family: 'Poppins', sans-serif;
            transition: background-color 0.3s;
        }

        .restart-adventure-btn:hover {
            background-color: var(--primary-dark);
        }

        /* Bingo Celebration */
        .bingo-celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            color: white;
            text-align: center;
            display: none;
        }

        .bingo-celebration.active {
            display: flex;
            animation: fadeIn 0.5s;
        }

        .bingo-celebration h2 {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--primary-light);
            text-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        .bingo-celebration p {
            font-size: 1.5rem;
            margin-bottom: 2rem;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--primary-light);
            opacity: 0;
        }

        /* Start Quiz Button */
        .start-quiz-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            transition: background-color 0.3s;
            margin-top: 1rem;
            display: block;
            width: 100%;
        }

        .start-quiz-btn:hover {
            background-color: var(--primary-dark);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .achievements-grid {
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .game-header {
                padding: 1.5rem;
            }
            
            .achievements-grid {
                grid-template-columns: 1fr;
            }
            
            .bingo-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .photo-challenges-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .avatar-options {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .quiz-options {
                grid-template-columns: 1fr;
            }
        }
        @keyframes bounce {
    0%, 100% { transform: translateY(0) scale(1); }
    50% { transform: translateY(-10px) scale(1.05); }
}

.avatar-option:hover img {
    transform: scale(1.1) rotate(5deg);
}
    </style>
</head>
<body>
    <div class="container">
        <!-- Gamification Header -->
        <div class="game-header">
            <h1 class="game-title">
                <i class="fas fa-map-marked-alt"></i> QuestLog
            </h1>
            <p class="game-subtitle">Your Personalized Travel Adventure Tracker</p>
            
            <div class="xp-container">
                <div class="xp-bar">
                    <div class="xp-progress" id="xpProgress"></div>
                </div>
                <div class="xp-text">
                    <span id="xpLevelName">Newbie Traveler</span>
                    <span><span id="currentXP">0</span>/<span id="maxXP">1000</span> XP</span>
                </div>
                <div class="level-badge">
                    <i class="fas fa-level-up-alt"></i> Level <span id="currentLevel">1</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Column -->
            <div class="left-column">
                <!-- Map Section -->
                <div class="map-container">
                    <div id="travelMap"></div>
                </div>
                
                <!-- Achievements Section -->
                <div class="achievements-section">
                    <div class="achievements-header">
                        <h2 class="section-title"><i class="fas fa-medal"></i> Your Achievements</h2>
                        <button class="btn btn-small" id="viewAllAchievements">
                    </div>
                    
                    <div class="achievements-grid" id="achievementsGrid">
                        <!-- Achievements will be loaded here -->
                    </div>
                </div>

                <!-- Travel Bingo Section -->
                <div class="bingo-section">
                    <h2 class="section-title"><i class="fas fa-th-large"></i> Traveller Bingo</h2>
                    <p style="font-size: 0.9rem; color: var(--text-light); margin-top: 0.5rem;">
                        Complete a row or column to earn rewards!
                    </p>
                    <div class="bingo-grid" id="bingoGrid">
                        <!-- Bingo cells will be generated by JavaScript -->
                    </div>
                    <div style="margin-top: 1rem; text-align: center;">
                        <button class="quiz-btn" id="checkBingoBtn">Check for Bingo</button>
                    </div>
                </div>

                <!-- Photo Challenges Section -->
                <div class="photo-challenges-section">
                    <h2 class="section-title"><i class="fas fa-camera-retro"></i> Photo Challenges</h2>
                    <p style="font-size: 0.9rem; color: var(--text-light); margin-top: 0.5rem;">
                        Complete these photo challenges to earn XP and badges
                    </p>
                    <div class="photo-challenges-grid" id="photoChallengesGrid">
                        <!-- Photo challenges will be generated by JavaScript -->
                    </div>
                </div>
            
        
                <!-- Adventure Game Section -->
                <div class="adventure-game-section">
                    <h2 class="section-title"><i class="fas fa-dice"></i> Choose Your Own Adventure</h2>
                    <p style="font-size: 0.9rem; color: var(--text-light); margin-top: 0.5rem;">
                        Make choices and see where your travel story takes you!
                    </p>
                    <!--div class="adventure-scene" id="adventureScene">
                        <div class="adventure-text" id="adventureText"></div>
                        <div class="adventure-options" id="adventureOptions"></div>
                        <div class="adventure-result" id="adventureResult"></div>
                    </div-->
                    <button class="quiz-btn" id="startAdventureBtn" style="width: 100%; margin-top: 1rem;">Start New Adventure</button>
                    
                </div>
            </div>

        
            
            <!-- Right Column -->
            <div class="right-column">
                <!-- Bucket List Section -->
                <div class="bucket-list-container">
                    <h2 class="section-title"><i class="fas fa-list-check"></i> My Travel Bucket List</h2>
                    <div class="bucket-list" id="bucketList">
                        <!-- Bucket list items will be added here by JavaScript -->
                    </div>
                    <div class="add-bucket-item">
                        <input type="text" class="add-bucket-input" id="newBucketItem" placeholder="Add a new travel goal...">
                        <button class="add-bucket-btn" id="addBucketBtn"><i class="fas fa-plus"></i></button>
                    </div>
                </div>
                
                <!-- Personality Quiz Section -->
                <div class="quiz-section">
                    <h2 class="section-title"><i class="fas fa-question-circle"></i> Traveller Personality Quiz</h2>
                    <p style="font-size: 0.9rem; color: var(--text-light); margin-top: 0.5rem;">
                        Discover your unique travel personality type!
                    </p>
                    <button class="start-quiz-btn" id="startQuizBtn">Take the Quiz</button>
                    <div class="quiz-container" id="quizContainer">
                        <!-- Quiz questions will be inserted here by JavaScript -->
                    </div>
                    <div class="quiz-result" id="quizResult">
                        <img src="" class="quiz-avatar" id="quizAvatar">
                        <h3 class="quiz-title" id="quizResultTitle"></h3>
                        <p class="quiz-desc" id="quizResultDesc"></p>
                    </div>
                </div>

                <!-- Postcard Generator Section -->
                <div class="postcard-section">
                    <h2 class="section-title"><i class="fas fa-envelope"></i> Travel Postcard Generator</h2>
                    <p style="font-size: 0.9rem; color: var(--text-light); margin-top: 0.5rem;">
                        Create and download custom travel postcards
                    </p>
                    
                    <div class="postcard-preview" id="postcardPreview">
                        <img src="https://images.unsplash.com/photo-1509316785289-025f5b846b35?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1476&q=80" class="postcard-image" id="postcardImage">
                        <div class="postcard-message" id="postcardMessage">Dear Friend,<br><br>Wish you were here! This place is amazing.<br><br>Best,<br>Me</div>
                        
                    </div>
                    
                    <div class="postcard-controls">
                        <div class="postcard-control-group">
                            <label for="postcardImageUrl">Image URL</label>
                            <input type="text" id="postcardImageUrl" placeholder="Enter image URL">
                        </div>
                        <div class="postcard-control-group">
                            <label for="postcardRecipient">Recipient</label>
                            <input type="text" id="postcardRecipient" placeholder="Who's it for?">
                        </div>
                        <div class="postcard-control-group">
                            <label for="postcardLocation">Location</label>
                            <input type="text" id="postcardLocation" placeholder="Where are you?">
                        </div>
                        <div class="postcard-control-group">
                            <label for="postcardStampStyle">Stamp Style</label>
                            <select id="postcardStampStyle">
                                <option value="classic">Classic</option>
                                <option value="modern">Modern</option>
                                <option value="vintage">Vintage</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="postcard-control-group">
                        <label for="postcardText">Message</label>
                        <textarea id="postcardText" rows="3" placeholder="Write your message here...">Dear Friend,&#10;&#10;Wish you were here! This place is amazing.&#10;&#10;Best,&#10;Me</textarea>
                    </div>
                    
                    <button class="postcard-btn" id="updatePostcardBtn">Update Postcard</button>
                    <button class="postcard-btn" id="downloadPostcardBtn">Download Postcard</button>
                </div>

                <!-- Journey Timeline -->
                <div class="timeline-section">
                    <h2 class="section-title"><i class="fas fa-history"></i> Your Journey Timeline</h2>
                    <div class="timeline" id="timeline">
                        <!-- Timeline items will be generated by JavaScript -->
                    </div>
                </div>

                <!-- Stats Section -->
                <div class="stats-section">
                    <h2 class="section-title"><i class="fas fa-chart-pie"></i> Your Travel Statistics</h2>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 1rem;">
                        <div class="stat-card">
                            <div class="stat-value" id="countriesCount">0</div>
                            <div class="stat-label">Countries</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="citiesCount">0</div>
                            <div class="stat-label">Cities</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="adventuresCount">0</div>
                            <div class="stat-label">Adventures</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bingo Celebration Modal -->
    <div class="bingo-celebration" id="bingoCelebration">
        <h2>BINGO!</h2>
        <p>You completed a full row or column!</p>
        <p>+50 XP</p>
        <button class="quiz-btn" id="closeBingoCelebration">Continue</button>
        <div id="confettiContainer"></div>
    </div>

    <!-- Leaflet JS for map -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- html2canvas for postcard download -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
        // App State
        const state = {
            // User stats
            stats: {
                xp: 450,
                level: 4,
                countries: 7,
                cities: 23,
                adventures: 15,
                photosTaken: 4,
                quizzesCompleted: 0,
                adventuresCompleted: 0,
                postcardsSent: 0
            },
            
            // Bucket List
            bucketItems: [
                { id: 1, text: "Visit the Great Wall of China", location: "China", completed: false, coordinates: null },
                { id: 2, text: "See the Northern Lights", location: "Iceland", completed: true, coordinates: { lat: 64.9631, lng: -19.0208 } },
                { id: 3, text: "Go on a Safari in Africa", location: "Kenya", completed: false, coordinates: null },
                { id: 4, text: "Swim in the Dead Sea", location: "Jordan", completed: false, coordinates: null }
            ],
            
            // Achievements
            achievements: [
                {
                    id: 1,
                    title: "World Explorer",
                    description: "Visit 5 different countries",
                    target: 5,
                    current: 0,
                    xpReward: 100,
                    icon: "globe-americas",
                    completed: false
                },
                {
                    id: 2,
                    title: "City Explorer",
                    description: "Visit 10 different cities",
                    target: 10,
                    current: 0,
                    xpReward: 75,
                    icon: "city",
                    completed: false
                },
                {
                    id: 3,
                    title: "Photo Enthusiast",
                    description: "Complete 5 photo challenges",
                    target: 5,
                    current: 0,
                    xpReward: 50,
                    icon: "camera",
                    completed: false
                },
                {
                    id: 4,
                    title: "Bucket List Champion",
                    description: "Complete 10 bucket list items",
                    target: 10,
                    current: 0,
                    xpReward: 150,
                    icon: "list-check",
                    completed: false
                },
                {
                    id: 5,
                    title: "Adventure Seeker",
                    description: "Complete 3 adventure stories",
                    target: 3,
                    current: 0,
                    xpReward: 80,
                    icon: "mountain",
                    completed: false
                },
                {
                    id: 6,
                    title: "Quiz Master",
                    description: "Complete 2 personality quizzes",
                    target: 2,
                    current: 0,
                    xpReward: 60,
                    icon: "question-circle",
                    completed: false
                },
                {
                    id: 7,
                    title: "Postcard Sender",
                    description: "Create and download 5 postcards",
                    target: 5,
                    current: 0,
                    xpReward: 50,
                    icon: "envelope",
                    completed: false
                }
            ],
            
            // Bingo
            bingoItems: [
                "Try local street food",
                "Take a sunrise photo",
                "Visit a UNESCO site",
                "Ride public transport",
                "Learn 5 local words",
                "Talk to a local",
                "Get lost and explore",
                "Try traditional clothes",
                "Visit a local market",
                "Attend a cultural event",
                "Take a cooking class",
                "Go on a guided tour",
                "Visit a museum",
                "Try a new activity",
                "Send a postcard home",
                "Watch a sunset",
                "Keep a travel journal",
                "Visit a famous landmark",
                "Try a local drink",
                "Take a scenic hike",
                "Visit a religious site",
                "Go to a local festival",
                "Eat at a family restaurant",
                "Take a boat ride",
                "Find a hidden gem"
            ],
            completedBingoItems: [0, 1, 6], // Indexes of completed items
            
            // Photo Challenges
            photoChallenges: [
                {
                    id: 1,
                    title: "Golden Hour Portrait",
                    description: "Take a portrait during golden hour",
                    completed: true,
                    image: "https://images.unsplash.com/photo-1509316785289-025f5b846b35?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1476&q=80",
                    xpReward: 20
                },
                {
                    id: 2,
                    title: "Local Cuisine",
                    description: "Photograph a traditional dish",
                    completed: false,
                    image: "https://images.unsplash.com/photo-1504674900247-0877df9cc836?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80",
                    xpReward: 15
                },
                {
                    id: 3,
                    title: "Landscape Panorama",
                    description: "Capture a stunning landscape",
                    completed: false,
                    image: "https://images.unsplash.com/photo-1501555088652-021faa106b9b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1473&q=80",
                    xpReward: 25
                },
                {
                    id: 4,
                    title: "Architecture Details",
                    description: "Focus on unique architectural elements",
                    completed: true,
                    image: "https://images.unsplash.com/photo-1526778548025-fa2f459cd5c1?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1433&q=80",
                    xpReward: 15
                },
                {
                    id: 5,
                    title: "Street Art",
                    description: "Find and photograph interesting street art",
                    completed: false,
                    image: "https://thegeestravel.com/wp-content/uploads/2022/09/Jalan-Alor-KL-Street-Art-1-Lane.jpg",
                    xpReward: 20
                },
                {
                    id: 6,
                    title: "Local Wildlife",
                    description: "Photograph an animal native to the area",
                    completed: false,
                    image: "https://images.unsplash.com/photo-1452570053594-1b985d6ea890?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1374&q=80",
                    xpReward: 25
                },
                {
                    id: 7,
                    title: "Night Lights",
                    description: "Take a photo of city lights at night",
                    completed: false,
                    image: "https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1413&q=80",
                    xpReward: 20
                },
                {
                    id: 8,
                    title: "Reflections",
                    description: "Capture an interesting reflection",
                    completed: false,
                    image: "https://images.unsplash.com/photo-1470115636492-6d2b56f9146d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80",
                    xpReward: 15
                },
                {
                    id: 9,
                    title: "Street Photography",
                    description: "Capture candid moments of local life",
                    completed: false,
                    image: "https://images.unsplash.com/photo-1509315811345-672d83ef2fbc?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1374&q=80",
                    xpReward: 20
                },
                {
                    id: 10,
                    title: "Water Reflections",
                    description: "Photograph reflections in water",
                    completed: false,
                    image: "https://images.unsplash.com/photo-1476231682828-37e571bc172f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1374&q=80",
                    xpReward: 15
                },
                {
                    id: 11,
                    title: "Local Crafts",
                    description: "Photograph traditional crafts or artisans",
                    completed: false,
                    image: "https://previews.123rf.com/images/savvas511/savvas5111801/savvas511180100149/93639455-local-arts-and-crafts-handmade.jpg",
                    xpReward: 20
                },
                {
                    id: 12,
                    title: "Transportation",
                    description: "Capture unique local transportation",
                    completed: false,
                    image: "https://images.unsplash.com/photo-1507035895480-2b3156c31fc8?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80",
                    xpReward: 15
                }
            ],
            
            // Travel Timeline
            timelineItems: [
                {
                    id: 1,
                    date: "June 2023",
                    content: "Visited Bali, Indonesia",
                    location: "Ubud, Bali"
                },
                {
                    id: 2,
                    date: "March 2023",
                    content: "Hiked Mount Fuji",
                    location: "Japan"
                },
                {
                    id: 3,
                    date: "December 2022",
                    content: "Christmas in New York",
                    location: "NYC, USA"
                }
            ],
            
            // Quiz
            quizQuestions: [
                {
                    id: 1,
                    question: "When planning a trip, you're most excited about:",
                    options: [
                        "Trying new foods and local cuisine",
                        "Exploring historical sites and museums",
                        "Outdoor adventures and nature",
                        "Meeting new people and cultural experiences"
                    ]
                },
                {
                    id: 2,
                    question: "Your ideal accommodation is:",
                    options: [
                        "A luxury hotel with all amenities",
                        "A cozy boutique hotel with character",
                        "A campsite or eco-lodge in nature",
                        "A local homestay or hostel to meet people"
                    ]
                },
                {
                    id: 3,
                    question: "What's your travel packing style?",
                    options: [
                        "Overpacker - I need options for every occasion",
                        "Efficient packer - just the essentials",
                        "Minimalist - the lighter the better",
                        "I always forget something important"
                    ]
                },
                {
                    id: 4,
                    question: "How do you prefer to get around?",
                    options: [
                        "Private car or taxi for convenience",
                        "Public transport to experience local life",
                        "Walking or cycling to see everything up close",
                        "Whatever gets me there fastest"
                    ]
                }
            ],
            quizAnswers: [],
            quizResults: [
                {
                    type: "The Foodie Explorer",
                    description: "You travel with your taste buds! Your ideal trips revolve around culinary experiences, from street food to fine dining. You love taking cooking classes and visiting local markets.",
                    avatar: "https://api.dicebear.com/7.x/bottts/svg?seed=Foodie&backgroundColor=ffdfbf"
                },
                {
                    type: "The Culture Seeker",
                    description: "You're fascinated by history, art, and architecture. Museums, historical sites, and cultural performances are must-dos on your itinerary. You probably know more about the local history than some residents!",
                    avatar: "https://api.dicebear.com/7.x/bottts/svg?seed=Culture&backgroundColor=ffdfbf"
                },
                {
                    type: "The Adventurous Explorer",
                    description: "You're always seeking new experiences off the beaten path! Your ideal trips involve hiking, trying extreme activities, and immersing yourself in nature. Comfort is secondary to adventure for you.",
                    avatar: "https://api.dicebear.com/7.x/bottts/svg?seed=Explorer&backgroundColor=ffdfbf"
                },
                {
                    type: "The Social Traveler",
                    description: "For you, travel is all about the people. You love meeting locals and fellow travelers, sharing stories, and making connections. You're probably still in touch with people from your last trip!",
                    avatar: "https://api.dicebear.com/7.x/bottts/svg?seed=Social&backgroundColor=ffdfbf"
                }
            ],
            currentQuestion: 0,
            quizStarted: false,
            
            // Adventure Game
            currentAdventureScene: 1,
            adventureLocation: "",
            adventureCompleted: false,
            adventureScenes: [
                // Initial choice (Step 1)
                {
                    id: 1,
                    text: "You arrive in a new city! The sights and sounds overwhelm your senses as you step out of the station. What's your first move?",
                    options: [
                        { text: "Head to the most famous landmark", nextScene: 2 },
                        { text: "Find a quiet caf to get oriented", nextScene: 3 },
                        { text: "Ask a local for hidden gems", nextScene: 4 }
                    ]
                },
                
                // Landmark path (Step 2)
                {
                    id: 2,
                    text: "At the landmark, a street performer offers you a flyer for an underground jazz club. Nearby, a food stall smells amazing.",
                    options: [
                        { text: "Follow the jazz club lead", nextScene: 5 },
                        { text: "Try the street food", nextScene: 6 },
                        { text: "People-watch from a nearby caf", nextScene: 7 }
                    ]
                },
                
                // Caf path (Step 2)
                {
                    id: 3,
                    text: "In the quiet caf, the barista notices your camera and mentions a secret photo exhibition tonight.",
                    options: [
                        { text: "Ask for exhibition details", nextScene: 8 },
                        { text: "Enjoy your coffee and journal", nextScene: 9 }
                    ]
                },
                
                // Local recommendation path (Step 2)
                {
                    id: 4,
                    text: "The local recommends a traditional bathhouse that few tourists know about, or a tiny bar with amazing local drinks.",
                    options: [
                        { text: "Try the bathhouse", nextScene: 10 },
                        { text: "Visit the local bar", nextScene: 11 }
                    ]
                },
                
                // Jazz club path (Step 3)
                {
                    id: 5,
                    text: "The jazz club is incredible! The owner offers you a backstage pass for tomorrow night if you help with setup today.",
                    options: [
                        { text: "Accept the offer", nextScene: 12 },
                        { text: "Politely decline", nextScene: 13 }
                    ]
                },
                
                // Street food path (Step 3)
                {
                    id: 6,
                    text: "The local food is delicious! The vendor invites you to help make some. A nearby group is heading to karaoke.",
                    options: [
                        { text: "Learn to make the local dish", nextScene: 14 },
                        { text: "Join the karaoke group", nextScene: 15 }
                    ]
                },
                
                // Caf people-watching path (Step 3)
                {
                    id: 7,
                    text: "From your window seat, you notice a book left behind with mysterious notes in the margins.",
                    options: [
                        { text: "Investigate the book", nextScene: 16 },
                        { text: "Return it to staff", nextScene: 17 }
                    ]
                },
                
                // Photo exhibition path (Step 3)
                {
                    id: 8,
                    text: "At the exhibition, you meet a photographer who offers to show you their favorite shooting spot at dawn.",
                    options: [
                        { text: "Accept the dawn invitation", nextScene: 18 },
                        { text: "Just enjoy the exhibition", nextScene: 19 }
                    ]
                },
                
                // Journaling path (Step 3)
                {
                    id: 9,
                    text: "A fellow traveler admires your journal and invites you to a writers' meetup happening later.",
                    options: [
                        { text: "Join the meetup", nextScene: 20 },
                        { text: "Continue solo", nextScene: 21 }
                    ]
                },
                
                // Bathhouse path (Step 3)
                {
                    id: 10,
                    text: "At the bathhouse, an elderly local offers to teach you proper etiquette and the history of the place.",
                    options: [
                        { text: "Accept the lesson", nextScene: 22 },
                        { text: "Relax quietly", nextScene: 23 }
                    ]
                },
                
                // Local bar path (Step 3)
                {
                    id: 11,
                    text: "The bar owner challenges you to try a local delicacy. A regular offers to share their favorite drink.",
                    options: [
                        { text: "Try the food challenge", nextScene: 24 },
                        { text: "Share drinks", nextScene: 25 }
                    ]
                },
                
                // Final outcomes (Steps 4-5)
                {
                    id: 12,
                    text: "Helping at the jazz club leads to meeting famous musicians. You're offered a gig as their tour photographer!",
                    options: [],
                    ending: "Unexpected Career Path",
                    xp: 100
                },
                {
                    id: 13,
                    text: "You enjoy the show but leave early, missing the afterparty where connections were made.",
                    options: [],
                    ending: "Nice Evening",
                    xp: 40
                },
                {
                    id: 14,
                    text: "Learning to cook the local dish leads to an invitation to a family dinner. You gain deep cultural insights and recipes to take home.",
                    options: [],
                    ending: "Cultural Immersion",
                    xp: 80
                },
                {
                    id: 15,
                    text: "Karaoke night turns into an all-night adventure with new friends who show you their favorite spots in the city.",
                    options: [],
                    ending: "Night to Remember",
                    xp: 70
                },
                {
                    id: 16,
                    text: "The book contains clues to a local mystery. Following them leads you on an adventure through hidden parts of the city.",
                    options: [],
                    ending: "Urban Explorer",
                    xp: 90
                },
                {
                    id: 17,
                    text: "The staff thanks you and offers you a free coffee. You spend a pleasant afternoon reading your own book.",
                    options: [],
                    ending: "Quiet Afternoon",
                    xp: 30
                },
                {
                    id: 18,
                    text: "The dawn photoshoot is magical. The photographer loves your work and invites you to collaborate on a project.",
                    options: [],
                    ending: "Creative Connection",
                    xp: 80
                },
                {
                    id: 19,
                    text: "You enjoy the exhibition but leave early to rest. The next day you explore on your own schedule.",
                    options: [],
                    ending: "Independent Explorer",
                    xp: 50
                },
                {
                    id: 20,
                    text: "The writers' meetup introduces you to fascinating people. One offers to publish your travel stories in a local magazine.",
                    options: [],
                    ending: "Published Writer",
                    xp: 70
                },
                {
                    id: 21,
                    text: "You enjoy a peaceful evening writing in your journal, capturing your first impressions of the city.",
                    options: [],
                    ending: "Personal Reflection",
                    xp: 40
                },
                {
                    id: 22,
                    text: "The lesson turns into a fascinating cultural exchange. The local invites you to meet their family for dinner.",
                    options: [],
                    ending: "Local Connection",
                    xp: 80
                },
                {
                    id: 23,
                    text: "You enjoy a relaxing soak and leave refreshed, ready to explore more tomorrow.",
                    options: [],
                    ending: "Rejuvenated",
                    xp: 50
                },
                {
                    id: 24,
                    text: "The food challenge earns you respect from the locals. They share stories and drinks late into the night.",
                    options: [],
                    ending: "Local Favorite",
                    xp: 70
                },
                {
                    id: 25,
                    text: "Sharing drinks leads to an all-night conversation about life in the city. You gain deep cultural insights.",
                    options: [],
                    ending: "Cultural Enlightenment", 
                    xp: 80
                }
            ],
            
            // Postcard Generator
            postcardSettings: {
                imageUrl: "https://images.unsplash.com/photo-1509316785289-025f5b846b35?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1476&q=80",
                recipient: "Friend",
                location: "Beautiful Place",
                message: "Dear Friend,\n\nWish you were here! This place is amazing.\n\nBest,\nMe",
                stampStyle: "classic"
            }
        };

        // Initialize the map
        const map = L.map('travelMap').setView([20, 0], 2);

        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Different icons for different location types
        const icons = {
            beach: L.divIcon({
                className: 'beach-icon',
                html: '<i class="fas fa-umbrella-beach" style="color: #ff6b6b; font-size: 24px;"></i>',
                iconSize: [24, 24],
                iconAnchor: [12, 12]
            }),
            mountain: L.divIcon({
                className: 'mountain-icon',
                html: '<i class="fas fa-mountain" style="color: #5f6caf; font-size: 24px;"></i>',
                iconSize: [24, 24],
                iconAnchor: [12, 12]
            }),
            city: L.divIcon({
                className: 'city-icon',
                html: '<i class="fas fa-city" style="color: #4b7bec; font-size: 24px;"></i>',
                iconSize: [24, 24],
                iconAnchor: [12, 12]
            })
        };

        // DOM Elements
        const elements = {
            bucketList: document.getElementById('bucketList'),
            newBucketItem: document.getElementById('newBucketItem'),
            addBucketBtn: document.getElementById('addBucketBtn'),
            bingoGrid: document.getElementById('bingoGrid'),
            checkBingoBtn: document.getElementById('checkBingoBtn'),
            photoChallengesGrid: document.getElementById('photoChallengesGrid'),
            quizContainer: document.getElementById('quizContainer'),
            quizResult: document.getElementById('quizResult'),
            quizAvatar: document.getElementById('quizAvatar'),
            quizResultTitle: document.getElementById('quizResultTitle'),
            quizResultDesc: document.getElementById('quizResultDesc'),
            avatarOptions: document.getElementById('avatarOptions'),
            avatarAccessories: document.getElementById('avatarAccessories'),
            avatarPreview: document.getElementById('avatarPreview'),
            saveAvatarBtn: document.getElementById('saveAvatarBtn'),
            timeline: document.getElementById('timeline'),
            countriesCount: document.getElementById('countriesCount'),
            citiesCount: document.getElementById('citiesCount'),
            adventuresCount: document.getElementById('adventuresCount'),
            xpProgress: document.getElementById('xpProgress'),
            currentXP: document.getElementById('currentXP'),
            maxXP: document.getElementById('maxXP'),
            currentLevel: document.getElementById('currentLevel'),
            xpLevelName: document.getElementById('xpLevelName'),
            achievementsGrid: document.getElementById('achievementsGrid'),
            viewAllAchievements: document.getElementById('viewAllAchievements'),
            adventureText: document.getElementById('adventureText'),
            adventureOptions: document.getElementById('adventureOptions'),
            adventureResult: document.getElementById('adventureResult'),
            startQuizBtn: document.getElementById('startQuizBtn'),
            startAdventureBtn: document.getElementById('startAdventureBtn'),
            bingoCelebration: document.getElementById('bingoCelebration'),
            closeBingoCelebration: document.getElementById('closeBingoCelebration'),
            confettiContainer: document.getElementById('confettiContainer'),
            postcardPreview: document.getElementById('postcardPreview'),
            postcardImage: document.getElementById('postcardImage'),
            postcardMessage: document.getElementById('postcardMessage'),
            postcardStamp: document.getElementById('postcardStamp'),
            postcardImageUrl: document.getElementById('postcardImageUrl'),
            postcardRecipient: document.getElementById('postcardRecipient'),
            postcardLocation: document.getElementById('postcardLocation'),
            postcardText: document.getElementById('postcardText'),
            postcardStampStyle: document.getElementById('postcardStampStyle'),
            updatePostcardBtn: document.getElementById('updatePostcardBtn'),
            downloadPostcardBtn: document.getElementById('downloadPostcardBtn')
        };

        // Initialize the app
        function initApp() {
            updateXpSystem();
            renderBucketList();
            renderAchievements();
            renderBingoGrid();
            renderPhotoChallenges();
            renderTimeline();
            updateStats();
            renderAvatarOptions();
            initPostcardGenerator();
            
            // Load saved state from localStorage
            loadState();
        }

        // XP and Level System
        function updateXpSystem() {
            // Calculate level based on XP (1000 XP per level)
            const newLevel = Math.floor(state.stats.xp / 1000) + 1;
            if (newLevel !== state.stats.level) {
                state.stats.level = newLevel;
                // Level up reward
                state.stats.xp += 100;
                showNotification(`Level Up! You're now Level ${state.stats.level}`);
            }
            
            
            const levelNames = [
                "Newbie Traveler",
                "Explorer",
                "Adventurer",
                "Globetrotter",
                "World Traveler",
                "Voyager",
                "Master Explorer",
                "Legendary Traveler"
            ];
            const levelName = levelNames[Math.min(state.stats.level - 1, levelNames.length - 1)];
            
            elements.currentXP.textContent = state.stats.xp;
            elements.maxXP.textContent = state.stats.level * 1000;
            elements.currentLevel.textContent = state.stats.level;
            elements.xpLevelName.textContent = levelName;
            elements.xpProgress.style.width = `${((state.stats.xp % 1000) / 1000) * 100}%`;
            
            // Update achievements based on level
            state.achievements.forEach(ach => {
                if (ach.id === 1) { // World Explorer
                    ach.current = state.stats.countries;
                } else if (ach.id === 2) { // City Explorer
                    ach.current = state.stats.cities;
                } else if (ach.id === 3) { // Photo Enthusiast
                    ach.current = state.stats.photosTaken;
                } else if (ach.id === 4) { // Bucket List Champion
                    ach.current = state.bucketItems.filter(item => item.completed).length;
                } else if (ach.id === 5) { // Adventure Seeker
                    ach.current = state.stats.adventuresCompleted;
                } else if (ach.id === 6) { // Quiz Master
                    ach.current = state.stats.quizzesCompleted;
                } else if (ach.id === 7) { // Postcard Sender
                    ach.current = state.stats.postcardsSent;
                }
            });
            
            checkAchievementCompletion();
        }

        // Add XP with optional notification
        function addXp(amount, message) {
            state.stats.xp += amount;
            updateXpSystem();
            saveState();
            
            if (message) {
                showNotification(`+${amount} XP: ${message}`);
            }
        }

        // Simple notification system
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Load state from localStorage
        function loadState() {
            const savedState = localStorage.getItem('questLogState');
            if (savedState) {
                const parsed = JSON.parse(savedState);
                
                // Merge with default state, preserving any new properties in default state
                for (const key in state) {
                    if (parsed[key] !== undefined) {
                        state[key] = parsed[key];
                    }
                }
                
                // Update UI
                updateXpSystem();
                renderBucketList();
                renderAchievements();
                renderBingoGrid();
                renderPhotoChallenges();
                renderTimeline();
                updateStats();
                renderAvatarOptions();
                updatePostcardPreview();
            }
        }

        // Save state to localStorage
        function saveState() {
            localStorage.setItem('questLogState', JSON.stringify(state));
        }

        // Bucket List Functions
        function renderBucketList() {
            elements.bucketList.innerHTML = '';
            state.bucketItems.forEach((item, index) => {
                const bucketItem = document.createElement('div');
                bucketItem.className = `bucket-item ${item.completed ? 'completed' : ''}`;
                bucketItem.innerHTML = `
                    <input type="checkbox" class="bucket-checkbox" ${item.completed ? 'checked' : ''} data-index="${index}">
                    <div class="bucket-text">
                        ${item.text}
                        <div class="bucket-location"><i class="fas fa-map-marker-alt"></i> ${item.location}</div>
                    </div>
                    <button class="delete-btn" data-id="${item.id}"><i class="fas fa-trash"></i></button>
                `;
                elements.bucketList.appendChild(bucketItem);
            });

            // Add event listeners to checkboxes
            document.querySelectorAll('.bucket-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const index = this.dataset.index;
                    state.bucketItems[index].completed = this.checked;
                    
                    if (this.checked) {
                        // Add XP for completing a bucket list item
                        addXp(25, `Completed: ${state.bucketItems[index].text}`);
                        
                        // Add to timeline
                        addTimelineItem(`Completed: ${state.bucketItems[index].text}`, state.bucketItems[index].location);
                        
                        // Automatically get coordinates
                        getCoordinatesForLocation(state.bucketItems[index].location)
                            .then(coords => {
                                if (coords) {
                                    state.bucketItems[index].coordinates = coords;
                                    addLocationToMap({
                                        id: state.bucketItems[index].id,
                                        name: state.bucketItems[index].text,
                                        lat: coords.lat,
                                        lng: coords.lng,
                                        type: 'city'
                                    });
                                    saveState();
                                }
                            });
                        
                        // Update stats
                        state.stats.cities++;
                        updateStats();
                    } else {
                        // Remove from map if unchecked
                        removeLocationFromMap(state.bucketItems[index].id);
                        
                        // Update stats
                        state.stats.cities--;
                        updateStats();
                    }
                    
                    renderBucketList();
                    saveState();
                    checkAchievementCompletion();
                });
            });
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const id = parseInt(this.dataset.id);
                    const index = state.bucketItems.findIndex(item => item.id === id);
                    
                    if (index !== -1) {
                        // Remove from map if it was there
                        if (state.bucketItems[index].completed && state.bucketItems[index].coordinates) {
                            removeLocationFromMap(id);
                            // Update stats
                            state.stats.cities--;
                            updateStats();
                        }
                        
                        state.bucketItems.splice(index, 1);
                        renderBucketList();
                        saveState();
                        checkAchievementCompletion();
                    }
                });
            });
        }

        // Get coordinates for a location using OpenStreetMap Nominatim API
        async function getCoordinatesForLocation(location) {
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(location)}`);
                const data = await response.json();
                
                if (data && data.length > 0) {
                    return {
                        lat: parseFloat(data[0].lat),
                        lng: parseFloat(data[0].lon)
                    };
                }
                return null;
            } catch (error) {
                console.error('Error fetching coordinates:', error);
                return null;
            }
        }

        // Add new bucket list item
        elements.addBucketBtn.addEventListener('click', function() {
            const text = elements.newBucketItem.value.trim();
            if (text) {
                const location = prompt("Enter location for this goal:");
                if (location !== null) { // Only add if user didn't cancel
                    state.bucketItems.unshift({
                        id: Date.now(),
                        text: text,
                        location: location || "Unknown",
                        completed: false,
                        coordinates: null
                    });
                    elements.newBucketItem.value = '';
                    renderBucketList();
                    saveState();
                    
                    // Add XP for adding a new goal
                    addXp(5, "New travel goal added");
                }
            }
        });

        // Also allow adding with Enter key
        elements.newBucketItem.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                elements.addBucketBtn.click();
            }
        });

        // Map Functions
        function addLocationToMap(location) {
            const marker = L.marker([location.lat, location.lng], {
                icon: icons[location.type] || icons.city
            }).addTo(map);
            marker.bindPopup(`<b>${location.name}</b><br>Location: ${location.lat.toFixed(4)}, ${location.lng.toFixed(4)}`);
            marker.locationId = location.id;
            return marker;
        }

        function removeLocationFromMap(locationId) {
            map.eachLayer(layer => {
                if (layer.locationId === locationId) {
                    map.removeLayer(layer);
                }
            });
        }

        // Achievements Functions
        function renderAchievements() {
            elements.achievementsGrid.innerHTML = '';
            
            // Filter to show only incomplete or recently completed achievements
            const achievementsToShow = state.achievements
                .filter(ach => !ach.completed || (ach.completed && ach.current >= ach.target));
            
            achievementsToShow.forEach(achievement => {
                const progressPercent = Math.min(100, (achievement.current / achievement.target) * 100);
                
                const achievementElement = document.createElement('div');
                achievementElement.className = `achievement ${achievement.completed ? 'completed' : ''}`;
                achievementElement.innerHTML = `
                    <div class="achievement-header">
                        <div class="achievement-icon"><i class="fas fa-${achievement.icon}"></i></div>
                        <div>
                            <h3 class="achievement-title">${achievement.title}</h3>
                            <div class="achievement-progress">
                                <div class="achievement-progress-bar" style="width: ${progressPercent}%"></div>
                            </div>
                        </div>
                    </div>
                    <p class="achievement-desc">${achievement.description} (${achievement.current}/${achievement.target})</p>
                    <div class="progress-milestones">
                        ${achievement.target >= 5 ? `
                        <div class="milestone">
                            <div class="milestone-badge">${Math.floor(achievement.target * 0.2)}</div>
                            <span>+${Math.floor(achievement.xpReward * 0.2)} XP</span>
                        </div>
                        <div class="milestone">
                            <div class="milestone-badge">${Math.floor(achievement.target * 0.5)}</div>
                            <span>+${Math.floor(achievement.xpReward * 0.5)} XP</span>
                        </div>
                        <div class="milestone">
                            <div class="milestone-badge">${achievement.target}</div>
                            <span>+${achievement.xpReward} XP</span>
                        </div>
                        ` : ''}
                    </div>
                `;
                
                elements.achievementsGrid.appendChild(achievementElement);
            });
        }

        function checkAchievementCompletion() {
            let xpEarned = 0;
            
            state.achievements.forEach(achievement => {
                // Check if achievement is completed
                if (!achievement.completed && achievement.current >= achievement.target) {
                    achievement.completed = true;
                    xpEarned += achievement.xpReward;
                    
                    // Show notification
                    showNotification(`Achievement Unlocked: ${achievement.title}! +${achievement.xpReward} XP`);
                    
                    // Add to timeline
                    addTimelineItem(`Achievement Unlocked: ${achievement.title}`, "");
                    
                    // Update stats if needed
                    if (achievement.id === 1) { // World Explorer
                        state.stats.countries++;
                    } else if (achievement.id === 3) { // Photo Enthusiast
                        state.stats.photosTaken++;
                    } else if (achievement.id === 5) { // Adventure Seeker
                        state.stats.adventuresCompleted++;
                    } else if (achievement.id === 6) { // Quiz Master
                        state.stats.quizzesCompleted++;
                    } else if (achievement.id === 7) { // Postcard Sender
                        state.stats.postcardsSent++;
                    }
                }
            });
            
            if (xpEarned > 0) {
                addXp(xpEarned, "Achievement rewards");
                saveState();
                renderAchievements();
                updateStats();
            }
        }

        // View all achievements
        elements.viewAllAchievements.addEventListener('click', function() {
            // Toggle between showing all and showing only incomplete
            renderAchievements();
        });

        // Bingo Functions
        function renderBingoGrid() {
            elements.bingoGrid.innerHTML = '';
            
            // Shuffle and select 25 items (for 5x5 grid)
            const shuffledItems = [...state.bingoItems].sort(() => 0.5 - Math.random());
            const selectedItems = shuffledItems.slice(0, 25);
            
            selectedItems.forEach((item, index) => {
                const cell = document.createElement('div');
                cell.className = `bingo-cell ${state.completedBingoItems.includes(index) ? 'completed' : ''}`;
                cell.textContent = item;
                cell.dataset.index = index;
                
                cell.addEventListener('click', function() {
                    const idx = parseInt(this.dataset.index);
                    const completedIdx = state.completedBingoItems.indexOf(idx);
                    
                    if (completedIdx === -1) {
                        state.completedBingoItems.push(idx);
                        // Add XP for completing a bingo item
                        addXp(5, `Bingo item: ${item}`);
                    } else {
                        state.completedBingoItems.splice(completedIdx, 1);
                    }
                    
                    this.classList.toggle('completed');
                    saveState();
                });
                
                elements.bingoGrid.appendChild(cell);
            });
        }

        // Check for bingo
        elements.checkBingoBtn.addEventListener('click', function() {
            // Check rows
            for (let row = 0; row < 5; row++) {
                let complete = true;
                for (let col = 0; col < 5; col++) {
                    const index = row * 5 + col;
                    if (!state.completedBingoItems.includes(index)) {
                        complete = false;
                        break;
                    }
                }
                if (complete) {
                    // Add XP reward for bingo
                    addXp(50, "Bingo! Completed a row");
                    celebrateBingo();
                    return;
                }
            }
            
            // Check columns
            for (let col = 0; col < 5; col++) {
                let complete = true;
                for (let row = 0; row < 5; row++) {
                    const index = row * 5 + col;
                    if (!state.completedBingoItems.includes(index)) {
                        complete = false;
                        break;
                    }
                }
                if (complete) {
                    // Add XP reward for bingo
                    addXp(50, "Bingo! Completed a column");
                    celebrateBingo();
                    return;
                }
            }
            
            // Check diagonals
            let diagonal1Complete = true;
            let diagonal2Complete = true;
            for (let i = 0; i < 5; i++) {
                if (!state.completedBingoItems.includes(i * 5 + i)) {
                    diagonal1Complete = false;
                }
                if (!state.completedBingoItems.includes(i * 5 + (4 - i))) {
                    diagonal2Complete = false;
                }
            }
            
            if (diagonal1Complete || diagonal2Complete) {
                // Add XP reward for bingo
                addXp(50, "Bingo! Completed a diagonal");
                celebrateBingo();
                return;
            }
            
            alert('No bingo yet - keep going!');
        });

        // Bingo celebration
        function celebrateBingo() {
            elements.bingoCelebration.classList.add('active');
            createConfetti();
        }

        // Close bingo celebration
        elements.closeBingoCelebration.addEventListener('click', function() {
            elements.bingoCelebration.classList.remove('active');
        });

        // Create confetti effect
        function createConfetti() {
            elements.confettiContainer.innerHTML = '';
            const colors = ['#ff6b6b', '#4b7bec', '#26de81', '#f7b731', '#a55eea'];
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.top = `${Math.random() * 100}%`;
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                confetti.style.width = `${Math.random() * 10 + 5}px`;
                confetti.style.height = `${Math.random() * 10 + 5}px`;
                confetti.style.animation = `fadeIn 0.5s forwards, fadeOut 1s ${Math.random() * 2 + 1}s forwards`;
                confetti.style.animationDelay = `${Math.random() * 0.5}s`;
                
                elements.confettiContainer.appendChild(confetti);
            }
        }

        // Photo Challenges Functions
        function renderPhotoChallenges() {
            elements.photoChallengesGrid.innerHTML = '';
            
            state.photoChallenges.forEach(challenge => {
                const challengeElement = document.createElement('div');
                challengeElement.className = 'photo-challenge';
                challengeElement.innerHTML = `
                    <img src="${challenge.image}" class="photo-challenge-image">
                    <div class="photo-challenge-info">
                        <div class="photo-challenge-title">${challenge.title}</div>
                        <div class="photo-challenge-desc">${challenge.description}</div>
                        ${challenge.completed ? '<span class="photo-challenge-status">Completed</span>' : ''}
                    </div>
                `;
                
                challengeElement.addEventListener('click', function() {
                    // Toggle completed status
                    challenge.completed = !challenge.completed;
                    
                    if (challenge.completed) {
                        // Add XP for completing a photo challenge
                        addXp(challenge.xpReward, `Photo challenge: ${challenge.title}`);
                        
                        // Add to timeline
                        addTimelineItem(`Photo Challenge: ${challenge.title}`, "");
                        
                        // Update stats
                        state.stats.photosTaken++;
                    } else {
                        // Update stats
                        state.stats.photosTaken--;
                    }
                    
                    // Re-render the challenges
                    renderPhotoChallenges();
                    saveState();
                    checkAchievementCompletion();
                    updateStats();
                });
                
                elements.photoChallengesGrid.appendChild(challengeElement);
            });
        }

        // Personality Quiz Functions
        function renderQuiz() {
            if (state.quizAnswers.length === state.quizQuestions.length) {
                showQuizResult();
                return;
            }
            
            elements.quizContainer.innerHTML = '';
            elements.quizResult.classList.remove('active');
            
            const currentQuestion = state.quizQuestions[state.currentQuestion];
            const questionElement = document.createElement('div');
            questionElement.className = 'quiz-question active';
            questionElement.innerHTML = `
                <div class="quiz-question-text">${currentQuestion.question}</div>
                <div class="quiz-options" id="quizOptions">
                    ${currentQuestion.options.map((option, idx) => `
                        <div class="quiz-option" data-index="${idx}">${option}</div>
                    `).join('')}
                </div>
                <div class="quiz-navigation">
                    <button class="quiz-btn" id="quizPrevBtn" ${state.currentQuestion === 0 ? 'disabled' : ''}>
                        <i class="fas fa-arrow-left"></i> Previous
                    </button>
                    <button class="quiz-btn" id="quizNextBtn" ${state.quizAnswers[state.currentQuestion] === undefined ? 'disabled' : ''}>
                        ${state.currentQuestion === state.quizQuestions.length - 1 ? 'See Results' : 'Next <i class="fas fa-arrow-right"></i>'}
                    </button>
                </div>
            `;
            
            elements.quizContainer.appendChild(questionElement);
            
            // Add event listeners to options
            document.querySelectorAll('.quiz-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.quiz-option').forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    state.quizAnswers[state.currentQuestion] = parseInt(this.dataset.index);
                    document.getElementById('quizNextBtn').disabled = false;
                });
            });
            
            // Add event listeners to navigation buttons
            document.getElementById('quizPrevBtn')?.addEventListener('click', function() {
                if (state.currentQuestion > 0) {
                    state.currentQuestion--;
                    renderQuiz();
                }
            });
            
            document.getElementById('quizNextBtn')?.addEventListener('click', function() {
                if (state.currentQuestion < state.quizQuestions.length - 1) {
                    state.currentQuestion++;
                    renderQuiz();
                } else {
                    showQuizResult();
                }
            });
        }

        function showQuizResult() {
            // Simple scoring - most frequent answer type determines result
            const answerCounts = [0, 0, 0, 0];
            state.quizAnswers.forEach(answer => {
                answerCounts[answer]++;
            });
            
            const maxCount = Math.max(...answerCounts);
            const resultIndex = answerCounts.indexOf(maxCount);
            const result = state.quizResults[resultIndex];
            
            elements.quizResult.classList.add('active');
            elements.quizAvatar.src = result.avatar;
            elements.quizResultTitle.textContent = result.type;
            elements.quizResultDesc.textContent = result.description;
            
            // Add XP for completing the quiz
            addXp(30, "Completed personality quiz");
            
            // Add to timeline
            addTimelineItem(`Completed Personality Quiz: ${result.type}`, "");
            
            // Update stats
            state.stats.quizzesCompleted++;
            updateStats();
            
            // Reset quiz for next time
            state.currentQuestion = 0;
            state.quizAnswers = [];
            state.quizStarted = false;
        }

        // Start quiz when button is clicked
        elements.startQuizBtn.addEventListener('click', function() {
            state.quizStarted = true;
            renderQuiz();
        });

        // Avatar Funct

        // Timeline Functions
        function renderTimeline() {
            elements.timeline.innerHTML = '';
            
            state.timelineItems.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'timeline-item';
                itemElement.innerHTML = `
                    <div class="timeline-dot"></div>
                    <div class="timeline-date">${item.date}</div>
                    <div class="timeline-content">${item.content}</div>
                    ${item.location ? `<div class="timeline-location">
                        <i class="fas fa-map-marker-alt"></i> ${item.location}
                    </div>` : ''}
                `;
                elements.timeline.appendChild(itemElement);
            });
        }

        function addTimelineItem(content, location) {
            const now = new Date();
            const month = now.toLocaleString('default', { month: 'long' });
            const year = now.getFullYear();
            
            state.timelineItems.unshift({
                id: Date.now(),
                date: `${month} ${year}`,
                content: content,
                location: location
            });
            
            // Limit timeline to 20 items
            if (state.timelineItems.length > 20) {
                state.timelineItems.pop();
            }
            
            renderTimeline();
            saveState();
        }

        // Stats Functions
        function updateStats() {
            elements.countriesCount.textContent = state.stats.countries;
            elements.citiesCount.textContent = state.stats.cities;
            elements.adventuresCount.textContent = state.stats.adventures;
        }

        // Adventure Game Functions
        function renderAdventureGame() {
            const scene = state.adventureScenes.find(s => s.id === state.currentAdventureScene);
            if (!scene) return;

            // Clear previous content
            elements.adventureText.textContent = '';
            elements.adventureOptions.innerHTML = '';
            elements.adventureResult.classList.remove('active');

            // Add location context
            const locationText = state.adventureLocation ? ` in ${state.adventureLocation}` : '';
            elements.adventureText.textContent = scene.text.replace("a new city", `a new city${locationText}`);

            // Add options if not an ending
            if (scene.options.length > 0) {
                scene.options.forEach(option => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'adventure-option';
                    optionElement.textContent = option.text;
                    optionElement.addEventListener('click', () => {
                        state.currentAdventureScene = option.nextScene;
                        renderAdventureGame();
                    });
                    elements.adventureOptions.appendChild(optionElement);
                });
            } else {
                // Show ending
                showAdventureResult(scene);
            }
        }

        function showAdventureResult(scene) {
            elements.adventureText.textContent = '';
            elements.adventureOptions.innerHTML = '';
            elements.adventureResult.classList.add('active');
            elements.adventureResult.innerHTML = `
                <h3>${scene.ending}</h3>
                <p>${scene.text}</p>
                <button class="restart-adventure-btn">Play Again</button>
            `;
            
            // Add XP for completing the adventure
            addXp(scene.xp, `Adventure completed: ${scene.ending}`);
            
            // Update stats
            state.stats.adventuresCompleted++;
            updateStats();
            
            // Add to timeline
            addTimelineItem(`Completed Adventure: ${scene.ending}${state.adventureLocation ? ` in ${state.adventureLocation}` : ''}`, "");
            
            // Set up restart button
            document.querySelector('.restart-adventure-btn').addEventListener('click', () => {
                startNewAdventure();
            });
        }

        // Start new adventure
        elements.startAdventureBtn.addEventListener('click', function() {
            startNewAdventure();
        });

        function startNewAdventure() {
            const location = prompt("Where would you like your adventure to take place? (e.g., Paris, Tokyo)");
            state.adventureLocation = location || "a mysterious location";
            state.currentAdventureScene = 1;
            state.adventureCompleted = false;
            renderAdventureGame();
        }

        // Postcard Generator Functions
        function initPostcardGenerator() {
            // Set initial values from state
            elements.postcardImageUrl.value = state.postcardSettings.imageUrl;
            elements.postcardRecipient.value = state.postcardSettings.recipient;
            elements.postcardLocation.value = state.postcardSettings.location;
            elements.postcardText.value = state.postcardSettings.message;
            elements.postcardStampStyle.value = state.postcardSettings.stampStyle;
            
            updatePostcardPreview();
            
            // Add event listeners
            elements.updatePostcardBtn.addEventListener('click', updatePostcardPreview);
            elements.downloadPostcardBtn.addEventListener('click', downloadPostcard);
        }

        function updatePostcardPreview() {
            // Update state with current values
            state.postcardSettings = {
                imageUrl: elements.postcardImageUrl.value,
                recipient: elements.postcardRecipient.value,
                location: elements.postcardLocation.value,
                message: elements.postcardText.value,
                stampStyle: elements.postcardStampStyle.value
            };
            
            // Update the preview
            elements.postcardImage.src = state.postcardSettings.imageUrl;
            elements.postcardMessage.innerHTML = state.postcardSettings.message.replace(/\n/g, '<br>');
            
            // Update stamp style
            let stampContent = '';
            switch(state.postcardSettings.stampStyle) {
                case 'classic':
                    stampContent = '<i class="fas fa-stamp" style="color: #d9534f; font-size: 1.5rem;"></i>';
                    break;
                case 'modern':
                    stampContent = '<i class="fas fa-qrcode" style="color: #333; font-size: 1.5rem;"></i>';
                    break;
                case 'vintage':
                    stampContent = '<i class="fas fa-crown" style="color: #f0ad4e; font-size: 1.5rem;"></i>';
                    break;
            }
            elements.postcardStamp.innerHTML = stampContent;
            
            saveState();
        }

        function downloadPostcard() {
            // Add XP for creating a postcard
            addXp(15, "Created a travel postcard");
            
            // Update stats
            state.stats.postcardsSent++;
            updateStats();
            
            // Add to timeline
            addTimelineItem("Created a Postcard", state.postcardSettings.location);
            
            // Use html2canvas to capture the postcard
            html2canvas(elements.postcardPreview).then(canvas => {
                const link = document.createElement('a');
                link.download = `postcard-${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                showNotification('Postcard downloaded successfully!');
            });
            
            saveState();
            checkAchievementCompletion();
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
            
            // Add some sample map markers for completed bucket list items
            state.bucketItems.forEach(item => {
                if (item.completed && item.coordinates) {
                    addLocationToMap({
                        id: item.id,
                        name: item.text,
                        lat: item.coordinates.lat,
                        lng: item.coordinates.lng,
                        type: 'city'
                    });
                }
            });
        });

        // Add some basic styling for notifications and other elements
        const style = document.createElement('style');
        style.textContent = `
            .notification {
                position: fixed;
                bottom: 20px;
                right: 20px;
                background-color: var(--primary);
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: var(--shadow-hover);
                animation: fadeIn 0.3s ease-out;
                z-index: 1000;
            }
            
            .delete-btn {
                background: none;
                border: none;
                color: var(--text-light);
                cursor: pointer;
                margin-left: 10px;
                transition: color 0.2s;
            }
            
            .delete-btn:hover {
                color: var(--danger);
            }
            
            .delete-packing-item {
                background: none;
                border: none;
                color: var(--text-light);
                cursor: pointer;
                margin-left: 10px;
                transition: color 0.2s;
            }
            
            .delete-packing-item:hover {
                color: var(--danger);
            }
            
            .header-avatar {
                position: absolute;
                top: 20px;
                left: 20px;
                width: 50px;
                height: 50px;
                border-radius: 50%;
                overflow: hidden;
                border: 2px solid white;
            }
            
            .avatar-option.locked {
                opacity: 0.5;
                cursor: not-allowed;
                background-color: var(--text-lighter);
            }
            
            .avatar-option.locked i {
                font-size: 1.5rem;
                color: var(--text);
            }
            
            .adventure-option {
                background-color: var(--card-bg);
                padding: 0.8rem;
                border-radius: 8px;
                cursor: pointer;
                transition: all 0.3s;
                border: 1px solid var(--primary-lighter);
            }
            
            .adventure-option:hover {
                background-color: var(--primary-lighter);
            }
            
            @keyframes fadeOut {
                from { opacity: 1; transform: translateY(0); }
                to { opacity: 0; transform: translateY(100px); }
            }
            
            .avatar-preview img {
                animation: float 3s ease-in-out infinite;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>